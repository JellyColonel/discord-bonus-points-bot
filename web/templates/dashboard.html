{% extends "base.html" %}

{% block title %}Dashboard - Bonus Points{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Stats Header -->
    <div class="stats-header">
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <h3>Balance (BP)</h3>
            <p class="stat-value" id="balance-display">{{ balance }}</p>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <h3>Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ progress_percentage }}%"></div>
            </div>
            <p class="stat-value">{{ completed_count }} / {{ total_activities }}</p>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ú®</div>
            <h3>Earned Today (BP)</h3>
            <p class="stat-value earned" id="earned-display">{{ total_earned }}</p>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <h3>Remaining (BP)</h3>
            <p class="stat-value remaining" id="remaining-display">{{ total_remaining }}</p>
        </div>
    </div>

    <!-- Status Badges & Controls -->
    <div class="status-and-controls">
        <div class="status-badges-inline">
            <div class="badge {% if vip_status %}badge-vip{% else %}badge-inactive{% endif %}" id="vip-badge" onclick="toggleVIP()" title="Click to toggle VIP status">
                {% if vip_status %}‚≠ê VIP Active{% else %}VIP Inactive{% endif %}
            </div>
            {% if event_active %}
            <div class="badge badge-event">üéâ x2 BP Event Active!</div>
            {% endif %}
        </div>
        
        <div class="balance-control-inline">
            <label for="balance-input">Set Balance:</label>
            <input type="number" id="balance-input" placeholder="Enter amount" min="0" max="1000000">
            <button onclick="setBalance()" class="btn btn-primary">Update</button>
        </div>
    </div>

    <!-- Search Box -->
    <div class="search-container">
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" 
                   id="activity-search" 
                   placeholder="Search activities..." 
                   autocomplete="off">
            <button class="search-clear" id="search-clear" style="display: none;">‚úï</button>
        </div>
        <div class="search-results-count" id="search-results-count" style="display: none;">
            <span id="search-count">0</span> results found
        </div>
    </div>

    <!-- Activity Tabs -->
    <div class="activity-tabs">
        <button class="tab-btn active" onclick="switchTab('active')" data-tab="active">
            ‚ú® Active Activities
            <span class="tab-count" id="active-count">{{ total_activities - completed_count }}</span>
        </button>
        <button class="tab-btn" onclick="switchTab('completed')" data-tab="completed">
            ‚úÖ Completed
            <span class="tab-count" id="completed-count">{{ completed_count }}</span>
        </button>
    </div>

    <!-- Active Activities Tab -->
    <div class="tab-content active" id="active-tab">
        {% for category, category_activities in activities.items() %}
        {% set active_activities = category_activities | selectattr('completed', 'equalto', False) | list %}
        {% if active_activities %}
        <div class="activity-category" data-category="{{ category }}">
            <h2 class="category-title">{{ category }}</h2>
            <div class="activity-grid">
                {% for activity in active_activities %}
                <div class="activity-card" 
                     data-activity-id="{{ activity.id }}"
                     data-category="{{ category }}">
                    <div class="activity-header">
                        <input type="checkbox" 
                               id="activity-{{ activity.id }}" 
                               onchange="toggleActivity('{{ activity.id }}', this.checked)">
                        <label for="activity-{{ activity.id }}">
                            {{ activity.name }}
                        </label>
                    </div>
                    <div class="activity-bp">
                        <span class="bp-value">{{ activity.bp_value }} BP</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
        
        {% if completed_count == total_activities %}
        <div class="empty-state">
            <div class="empty-icon">üéâ</div>
            <h3>All Activities Completed!</h3>
            <p>Great job! Check the Completed tab to review or uncheck activities.</p>
        </div>
        {% endif %}
    </div>

    <!-- Completed Activities Tab -->
    <div class="tab-content" id="completed-tab">
        {% for category, category_activities in activities.items() %}
        {% set completed_activities = category_activities | selectattr('completed', 'equalto', True) | list %}
        {% if completed_activities %}
        <div class="activity-category" data-category="{{ category }}">
            <h2 class="category-title">{{ category }}</h2>
            <div class="activity-grid">
                {% for activity in completed_activities %}
                <div class="activity-card completed" 
                     data-activity-id="{{ activity.id }}"
                     data-category="{{ category }}">
                    <div class="activity-header">
                        <input type="checkbox" 
                               id="activity-completed-{{ activity.id }}" 
                               checked
                               onchange="toggleActivity('{{ activity.id }}', this.checked)">
                        <label for="activity-completed-{{ activity.id }}">
                            {{ activity.name }}
                        </label>
                    </div>
                    <div class="activity-bp">
                        <span class="bp-value">{{ activity.bp_value }} BP</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
        
        {% if completed_count == 0 %}
        <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <h3>No Completed Activities Yet</h3>
            <p>Start checking off activities to see them here!</p>
        </div>
        {% endif %}
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}