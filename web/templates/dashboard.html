{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å - –ë–æ–Ω—É—Å–Ω—ã–µ –û—á–∫–∏{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- Stats Header -->
    <div class="stats-header">
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <h3>–ë–∞–ª–∞–Ω—Å (BP)</h3>
            <p class="stat-value" id="balance-display">{{ balance }}</p>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <h3>–ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ progress_percentage }}%"></div>
            </div>
            <p class="stat-value">{{ completed_count }} / {{ total_activities }}</p>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚ú®</div>
            <h3>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –°–µ–≥–æ–¥–Ω—è (BP)</h3>
            <p class="stat-value earned" id="earned-display">{{ total_earned }}</p>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <h3>–û—Å—Ç–∞–ª–æ—Å—å (BP)</h3>
            <p class="stat-value remaining" id="remaining-display">{{ total_remaining }}</p>
        </div>
    </div>

    <!-- Status Badges & Controls -->
    <div class="status-and-controls">
        <div class="status-badges-inline">
            <div class="badge {% if vip_status %}badge-vip{% else %}badge-inactive{% endif %}" id="vip-badge" onclick="toggleVIP()" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è VIP —Å—Ç–∞—Ç—É—Å–∞">
                {% if vip_status %}‚≠ê VIP –ê–∫—Ç–∏–≤–µ–Ω{% else %}VIP –ù–µ–∞–∫—Ç–∏–≤–µ–Ω{% endif %}
            </div>
            {% if event_active %}
            <div class="badge badge-event">üéâ –°–æ–±—ã—Ç–∏–µ x2 BP –ê–∫—Ç–∏–≤–Ω–æ!</div>
            {% endif %}
        </div>
        
        <div class="balance-control-inline">
            <label for="balance-input">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–∞–ª–∞–Ω—Å:</label>
            <input type="number" id="balance-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" min="0" max="1000000">
            <button onclick="setBalance()" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
    </div>

    <!-- Search Box -->
    <div class="search-container">
        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" 
                   id="activity-search" 
                   placeholder="–ü–æ–∏—Å–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π..." 
                   autocomplete="off">
            <button class="search-clear" id="search-clear" style="display: none;">‚úï</button>
        </div>
        <div class="search-results-count" id="search-results-count" style="display: none;">
            <span id="search-count">0</span> —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω–æ
        </div>
    </div>

    <!-- Activity Tabs -->
    <div class="activity-tabs">
        <button class="tab-btn active" onclick="switchTab('active')" data-tab="active">
            ‚ú® –ê–∫—Ç–∏–≤–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è
            <span class="tab-count" id="active-count">{{ total_activities - completed_count }}</span>
        </button>
        <button class="tab-btn" onclick="switchTab('completed')" data-tab="completed">
            ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ
            <span class="tab-count" id="completed-count">{{ completed_count }}</span>
        </button>
    </div>

    <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ó–∞–¥–∞–Ω–∏—è Tab -->
    <div class="tab-content active" id="active-tab">
        {% for category, category_activities in activities.items() %}
        {% set active_activities = category_activities | selectattr('completed', 'equalto', False) | list %}
        {% if active_activities %}
        <div class="activity-category" data-category="{{ category }}">
            <h2 class="category-title">{{ category }}</h2>
            <div class="activity-grid">
                {% for activity in active_activities %}
                <div class="activity-card" 
                     data-activity-id="{{ activity.id }}"
                     data-category="{{ category }}">
                    <div class="activity-header">
                        <input type="checkbox" 
                               id="activity-{{ activity.id }}" 
                               onchange="toggleActivity('{{ activity.id }}', this.checked)">
                        <label for="activity-{{ activity.id }}">
                            {{ activity.name }}
                        </label>
                    </div>
                    <div class="activity-bp">
                        <span class="bp-value">{{ activity.bp_value }} BP</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
        
        {% if completed_count == total_activities %}
        <div class="empty-state">
            <div class="empty-icon">üéâ</div>
            <h3>All Activities –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ!</h3>
            <p>Great job! Check the –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ tab to review or uncheck activities.</p>
        </div>
        {% endif %}
    </div>

    <!-- –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ Activities Tab -->
    <div class="tab-content" id="completed-tab">
        {% for category, category_activities in activities.items() %}
        {% set completed_activities = category_activities | selectattr('completed', 'equalto', True) | list %}
        {% if completed_activities %}
        <div class="activity-category" data-category="{{ category }}">
            <h2 class="category-title">{{ category }}</h2>
            <div class="activity-grid">
                {% for activity in completed_activities %}
                <div class="activity-card completed" 
                     data-activity-id="{{ activity.id }}"
                     data-category="{{ category }}">
                    <div class="activity-header">
                        <input type="checkbox" 
                               id="activity-completed-{{ activity.id }}" 
                               checked
                               onchange="toggleActivity('{{ activity.id }}', this.checked)">
                        <label for="activity-completed-{{ activity.id }}">
                            {{ activity.name }}
                        </label>
                    </div>
                    <div class="activity-bp">
                        <span class="bp-value">{{ activity.bp_value }} BP</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
        
        {% if completed_count == 0 %}
        <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π</h3>
            <p>–ù–∞—á–Ω–∏—Ç–µ –æ—Ç–º–µ—á–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏—Ö –∑–¥–µ—Å—å!</p>
        </div>
        {% endif %}
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}